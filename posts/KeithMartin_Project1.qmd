---
title: "Keith Martin Project 1"
author: "Keith Martin"
desription: "Analysis on Dispensary Licensing"
date: "07/17/2023"
format:
  html:
    toc: true
    code-fold: true
    code-copy: true
    code-tools: true
categories:
  - project1
  - dataset
  - ggplot2
---

```{r}
#| label: setup
#| warning: false

library(tidyverse)
library(readxl)
library(summarytools)
library(ggplot2)
library(magrittr)
knitr::opts_chunk$set(echo = TRUE)
```

## Reading The Data



```{r}
PA_Dispensary_License_Data_tab <- read_excel("~/Downloads/PA Dispensary License Data.tab.xlsx")
head(PA_Dispensary_License_Data_tab, 10)

```
The data set includes various companies that applied for a dispensary license in 2018. There are 16 categories that are added up to a total score. The score is used to determine whether or not the company will receive a license to operate a dispensary. 

## Cleaning Data

```{r}
 PA_Dispensary_License_Condensed<-PA_Dispensary_License_Data_tab %>%
      select(name, diversityplan, qualifications, security, capital,licensed, awarded)
head(PA_Dispensary_License_Condensed, 10)
```

I grouped the data set into several categories that I will focus on in this project and in future projects.


## Cumulative Distribution Function

```{r}
ggplot(PA_Dispensary_License_Condensed, aes(x = capital)) +
  stat_ecdf(geom = "step") +
  labs(x = "capital", y = "Cumulative Probability") +
  ggtitle("Cumulative Density Function for Capital") +
  theme_minimal()
```

The CDF provides information about the cumulative probability of the variable capital taking on certain values or being less than or equal to a specific value. Specifically, for any given value x of capital, the CDF tells us the probability that capital is less than or equal to x.

By examining the CDF for capital, we can understand the distribution of the variable. In this case, the majority of the values of capital sit around the 45-70 range on the x-axis. There are not as many variables under 40. On the other hand, the CDF increases gradually, it indicates a more uniform distribution of capital across its range, Additionally, the shape of the CDF can provide insights into the central tendency, spread, and skewness of the capital variable.

In summary, the CDF for the variable capital helps us understand the probability distribution of capital, assess the likelihood of specific values or ranges, and calculate percentiles or quantiles.

```{r}
ggplot(PA_Dispensary_License_Condensed, aes(x = licensed)) +
  stat_ecdf(geom = "step") +
  labs(x = "Licensed", y = "Cumulative Probability") +
  ggtitle("Cumulative Density Function For Licensed Variable") +
  theme_minimal()
```

Contrary to above, the CDF for Licensed shows a dramatic increase. It still has a vague shape of of the cumulative density function, but since the variable in binary, it does not neatly plot.

```{r}

ggplot(PA_Dispensary_License_Condensed, aes(x = capital, fill = licensed)) +
  geom_density(alpha = 0.5) +
  labs(x = "Capital", y = "Density", fill = "licensed") +
  ggtitle("Probability Density Function") +
  theme_minimal()
```

The PDF shows that the distribution of the variables Capital and Licensed is skewed left, also known as a negative-skewed distribution. This means that the tail of the distribution extends towards lower values.

In the case of the variables Capital and Licensed, a left-skewed distribution indicates that there is a concentration of higher values for Capital and a smaller number of lower values. It suggests that the proportion of observations with a value of Licensed equal to 1 may be higher compared to the proportion with a value of 0.

When plotting the PDF, you will notice a longer tail on the left-hand side of the distribution. The majority of data points will be clustered towards the higher end of the Capital variable, with progressively fewer observations occurring as the values decrease.

It's important to keep in mind that skewness only describes the shape of the distribution and does not imply any causality or the direction of a relationship between the variables.

# Summary Statistics

```{r}
### Find Summary Statistics
 avg <- PA_Dispensary_License_Condensed%>%
  group_by(licensed)%>%
  summarise(
      sd_capital = sd (capital, na.rm=TRUE),
      max_capital = max(capital, na.rm = TRUE),
      min_capital = min(capital, na.rm = TRUE),
      avg_capital = mean (capital, na.rm = TRUE),
      med_capital = median(capital, na.rm = TRUE),
      n_capital = n()) 


### Average into own variables
Licensed_avg <- avg %>% dplyr::filter(licensed == 1) %>% pull(avg_capital)

Unlicensed_avg <- avg %>% dplyr::filter(licensed == 0) %>% pull(avg_capital)

### Separate Standard Deviation into own variables
Licensed_sd <- avg %>% dplyr::filter(licensed == 1) %>% pull(sd_capital)

Unlicensed_sd <- avg %>% dplyr::filter(licensed == 0) %>% pull(sd_capital)

### Separate n() into own variables
Licensed_n <- avg %>% dplyr::filter(licensed == 1) %>% pull(n_capital)

Unlicensed_n <- avg %>% dplyr::filter(licensed == 0) %>% pull(n_capital)

### statistical equations

score_diff <- Licensed_avg - Unlicensed_avg


se <- sqrt(Licensed_sd^2/Licensed_n + Unlicensed_sd^2/Unlicensed_n)



ci_lic_l <- score_diff - 1.96* se
ci_lic_u <- score_diff + 1.96 * se



### Data Frame with all of the results neatly labeled
results <- data.frame(
  Licensed_avg = Licensed_avg,
  Unlicensed_avg = Unlicensed_avg,
  Licensed_sd = Licensed_sd,
  Unlicensed_sd = Unlicensed_sd,
  Licensed_n = Licensed_n,
  Unlicensed_n = Unlicensed_n,
  score_diff = score_diff,
  se = se,
  ci_lic_l = ci_lic_l,
  ci_lic_u = ci_lic_u
)

print(results)
```
The above table captures the averages, standard deviation, the number, the difference of means, the standard error and the confidence intervals. The show the relationships between capital scores of companies that received a licensed and those who did not receive a license.  Capital has a confidence interval of 8.307839 to 12.12237 when grouped by license, it means that we are estimating a range of plausible values for the average capital depending on the group (licensed).

Specifically, this confidence interval provides an estimate of the range within which we can be reasonably confident that the true average capital falls, based on the data and statistical analysis. The confidence interval suggests that we are 95% confident that the true average capital for the respective groups falls between the values of 8.307839 and 12.12237. Note the confidence interval is the upper and lower bounds of the differences in the sampe means, not the actual X values.
# Scatterplot with Data

```{r}
### Scatterplot using GGplot

ggplot(PA_Dispensary_License_Condensed, aes(x = capital, y = licensed, na.rm=TRUE)) +
  geom_point() +
  labs(x = "Capital", y = "Licensed")
```

The above scatter plot shows the relationship between capital score and dispensaries that received a license. As you can see, the graph does not do a great job showing the relationship since the licensed variable is binary. This will be built on in future projects when other regressors are added.

```{r}
ggplot(data = PA_Dispensary_License_Condensed, aes(x = capital, fill = factor(licensed))) +
  geom_bar() +
  labs(x = "Capital", y = "Count", fill = "Licensed") +
  ggtitle("Bar Chart: Capital vs Licensed")
```
I have included this bar chart to further visualize the relationship between the capital score and whether or not they received a license.

# Alternative Standard Error and Confidence Interval Using T Test 

```{r}
###Find confidence interval of of licensed vs unlicensed 

confidence_level <- 0.95
ci <- t.test(PA_Dispensary_License_Condensed$capital ~ PA_Dispensary_License_Condensed$licensed, conf.level = confidence_level)$conf.int
print(ci)

### Alternative method for automatically finding the standard error based on the T.Test
result_se <- t.test(PA_Dispensary_License_Condensed$capital ~ PA_Dispensary_License_Condensed$licensed)
standard_error <- result_se$stderr
print(standard_error)
```

The above standard error and confidence intervals are additional tests showing the accuracy of the values calculated above. As you can see, the values are almost the exact same within a tenth of a decimal point.
#Regression Analysis

```{r}
linear_model<-lm(licensed ~ capital, data = PA_Dispensary_License_Condensed)

summary(linear_model)$coefficient

### Have to plot it differently

plot(PA_Dispensary_License_Condensed$capital, PA_Dispensary_License_Condensed$licensed, main = "Regression Results", xlab = "X", ylab = "Y")
abline(linear_model, col = "red", lwd = 2)
```
In summary, a T-value of 4.235692 for the independent variable capital in a simple regression with the dependent variable licensed indicates a strong relationship between the variables, and the relationship is statistically significant based on the chosen level of significance. In this case, the p-value is extremely small and less than one 1%. The chosen level of significance for this case would be P<.05. More specifically, if the p-value is below the predetermined significance level, it suggests that the probability of observing the results under the null hypothesis are very low. In such cases, it is generally concluded that there is a statistically significant relationship in the data.

For each unit increase in the capital variable, there is an estimated increase of approximately 0.006579464 in the probability or likelihood of the licensed variable being equal to 1, assuming all other factors are held constant.

In plain English, this means that as the capital variable increases, the estimated effect is a slight increase in the probability of having a value of 1 for the licensed variable. However, since the coefficient is very small (0.006579464), the practical significance of this effect may be limited.

Since the dependent variable is a dummy (binary) variable, the regression line does not fit that nicely on the plot. I did some additional research and found that a curve is more fitting for this type of variable. 
# Regression Analysis With Binary Variable

```{r}
### Regression Graph for Dummy Dependent Variable

model <- glm(licensed ~ capital, data = PA_Dispensary_License_Condensed, family = binomial)
plot(PA_Dispensary_License_Condensed$capital, PA_Dispensary_License_Condensed$licensed, main = "Regression Plot of Licensed vs. Capital", xlab = "Capital", ylab = "Licensed")
### This code adds a curve instead of a standard line(abline) for regression of dummy dependent variables
curve(predict(model, data.frame(capital = x), type = "response"), add = TRUE, col = "red")
```

In the above plot, I used a general linear model to predict the curve of the dummy variable. This is a much cleaner plot that the original regression line above. This more closely illustrates the relationship between capital score and licensing outcome.
